/*******************************************************************************
 * Copyright (c) 2019 IBM Corporation and others.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License 2.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-2.0/
 * 
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     IBM Corporation - initial API and implementation
 *******************************************************************************/

/**
 * Configure Gradle Build Cache.
 * See: https://docs.gradle.org/current/userguide/build_cache.html
 */
if (gradle.userProps.getProperty('is.using.artifactory')) {
  String buildCacheURL = ('https://' + gradle.userProps.getProperty('artifactory.download.server') + '/artifactory/wasliberty-generic-local/')
  if ('true'.equalsIgnoreCase(gradle.userProps.getProperty('is.continuous.build'))) {
    buildCacheURL = ('https://' + gradle.userProps.getProperty('artifactory.upload.server') + '/artifactory/wasliberty-generic-local/')
  }

  buildCache {
    remote(HttpBuildCache) {
      url = buildCacheURL
      push = 'true'.equalsIgnoreCase(gradle.userProps.getProperty('is.continuous.build'))

      credentials {
        username = gradle.userProps.getProperty("artifactory.download.user")
        password = gradle.userProps.getProperty("artifactory.download.token")
      }
    }
  }
}
